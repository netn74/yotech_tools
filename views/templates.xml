<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <template id="add_css_js" name="yotech_tools_yocolormaker" inherit_id="website.layout">
            <xpath expr="//html/head" position="inside">
                <link href="/yotech_tools/static/src/css/yocolormaker.css" rel="stylesheet"/>
                <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
                <script type="text/javascript" src="/yotech_tools/static/src/js/yocolormaker.js"></script>
            </xpath>
            <xpath expr="//html/body" position="inside">
                <!-- -->
            </xpath>
        </template>

        <!-- Product attribute -->

        <record id="yotech_tools_variants_template_tree_view" model="ir.ui.view">
            <field name="name">yotech_tools.variants.template.tree</field>
            <field name="model">product.attribute.value</field>
            <field name="inherit_id" ref="product.variants_tree_view"/>
            <field name="arch" type="xml">
                <field name="name" position="after">
                    <field name="jsdata"/>
                </field>
            </field>
        </record>

        <!-- Category Menu - overload kingfisher theme /kingfisher_theme/views/theme.xml -->
        <template id="website_sale.categories_recursive" name="Category list">
            <li t-att-class="'active selected' if c.id == int(category or 0) else ''">
                <a t-att-href="keep('/shop/category/' + slug(c), category=0)" t-field="c.name"></a>
                <t t-if="c.child_id"><span class="sub-cat-1"/></t>
                <ul t-if="c.child_id" class="nav nav-pills nav-stacked mt16">
                    <t t-foreach="c.child_id" t-as="c">
                        <li t-att-class="'active selected' if c.id == int(category or 0) else ''">
                            <a t-att-href="keep('/shop/category/' + slug(c), category=0)" t-field="c.name"></a>
                            <t t-if="c.child_id"><span class="sub-cat-2"/></t>
                            <ul t-if="c.child_id" class="nav nav-pills nav-stacked mt16">
                                <t t-foreach="c.child_id" t-as="c1">
                                    <li t-att-class="'active selected' if c1.id == int(category or 0) else ''">
                                        <a t-att-href="keep('/shop/category/' + slug(c1), category=0)" t-field="c1.name"></a>
                                        <t t-if="c1.child_id"><span class="sub-cat-3"/></t>
                                        <ul t-if="c1.child_id" class="nav nav-pills nav-stacked mt16">
                                            <t t-foreach="c1.child_id" t-as="c2">
                                                <li t-att-class="'active selected' if c2.id == int(category or 0) else ''">
                                                    <a t-att-href="keep('/shop/category/' + slug(c2), category=0)" t-field="c2.name"></a>
                                                    <t t-if="c2.child_id"><span class="sub-cat-4"/></t>
                                                    <ul t-if="c2.child_id" class="nav nav-pills nav-stacked mt16">
                                                        <t t-foreach="c2.child_id" t-as="c3">
                                                            <li t-att-class="'active selected' if c3.id == int(category or 0) else ''">
                                                                <a t-att-href="keep('/shop/category/' + slug(c3), category=0)" t-field="c3.name"></a>
                                                                <t t-if="c3.child_id"><span class="sub-cat-5"/></t>
                                                                <ul t-if="c3.child_id" class="nav nav-pills nav-stacked mt16">
                                                                    <t t-foreach="c3.child_id" t-as="c4">
                                                                        <li t-att-class="'active selected' if c4.id == int(category or 0) else ''">
                                                                              <a t-att-href="keep('/shop/category/' + slug(c4), category=0)" t-field="c4.name"></a>
                                                                        </li>
                                                                    </t>
                                                                </ul>
                                                            </li>
                                                        </t>
                                                    </ul>
                                                </li>
                                            </t>
                                        </ul>
                                    </li>
                                </t>
                            </ul>
                        </li>
                    </t>
                </ul>
            </li>
        </template>

        <!-- Add Btn Add to Cart On each variant line -->
        <template id="yotech_tools_products_variants">
            <t t-set="attribute_value_ids" t-value="get_attribute_value_ids(product)"/>
            <t t-set="website_sale_order" t-value="website.sale_get_order()"/>
            <t t-set="attr_color_available" t-value="0"/>
            <ul t-attf-class="list-unstyled js_add_cart_variants #{ul_class}" t-att-data-attribute_value_ids="attribute_value_ids">

                <t t-foreach="product.attribute_line_ids" t-as="variant_id">
                    <li t-if="len(variant_id.value_ids) > 1">
                        <t t-if="variant_id.attribute_id.type == 'color'">
                            <t t-set="attr_color_available" t-value="1"/>
                        </t>
                         <t t-if="not lang_selected">
                             <t t-set="lang_selected" t-value="0"/>
                         </t>
                        <!-- select -->
                        <t t-if="variant_id.attribute_id.type in ['select', 'hidden']">
                        <strong t-field="variant_id.attribute_id.name"/>
                        <br/>
                        <span>lang_selected : <span t-esc="lang_selected"/></span>
                        <br/>
                        <select class="form-control js_variant_change" name="language_select">
                            <t t-foreach="variant_id.value_ids" t-as="value_id">
                                <option t-att-value="value_id.id" t-att-selected="int(value_id.id) == int(lang_selected)" >
                                    <span t-field="value_id.name"/>
                                </option>
                            </t>
                        </select>
                        <!-- select Size Model -->
                        <t t-if="variant_id.attribute_id.name == 'size' or variant_id.attribute_id.name == 'model'">
                            <span style="font-style: italic;" > EAN <span t-field="product.ean13"/> - Reference ( <span t-field="product.default_code"/> ) </span>
                            <br/><br/>
                            <form t-att-action="keep('/shop/cart/update')" style="display:block;" class="js_add_cart_variants" method="POST">
                              <div>
                                <input name="product_id" t-att-value="product.id" type="hidden"/>
                                <a id="add_to_cart" class="btn btn-primary btn-product-detail-add-to-cart btn-lg mt8 fa fa-shopping-cart js_check_product a-submit" href="#"> Add to Cart</a>
                              </div>
                            </form>
                        </t>
                        </t>
                    </li>
                </t>
                <t t-if="attr_color_available">
                    <!-- Color -->
                    <t t-set="inc" t-value="1"/>
                    <strong>color</strong>
                    <t t-set="lang_id" t-value="0"/>
                    <t t-set="lang_name" t-value="french"/>
                    <ul class="ul-product-detail-add-to-cart" t-foreach="product.product_variant_ids" t-as="product_id">
                        <t t-foreach="product_id.attribute_value_ids" t-as="value_id">
                            <t t-if="value_id.attribute_id.type == 'select'">
                                <t t-set="lang_id" t-value="value_id.id"/>
                                <t t-set="lang_name" t-value="value_id.name"/>
                            </t>
                        </t>
                        <li class="li-product-detail" t-att-data-lang="lang_id" >
                            <!-- <span t-field="product_id.lst_price" style="white-space: nowrap;" t-field-options='{
                                                 "widget": "monetary",
                                                  "from_currency": "product.company_id.currency_id",
                                                 "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                                             }'/> -->
                            <t t-if="(compute_currency(product_id.lst_price) - product_id.price) &gt; 0.1">
                              <del class="text-danger" style="white-space: nowrap;"
                                t-field="product_id.lst_price" t-field-options='{
                                    "widget": "monetary",
                                    "from_currency": "product.company_id.currency_id",
                                    "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                                }'/>&amp;nbsp;
                            </t>
                            <span t-field="product_id.price" style="white-space: nowrap;" t-field-options='{
                                 "widget": "monetary",
                                 "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                             }'/>
                            <t t-if ="product_id.product_cart_quantity">
                                <span><i class="fa fa-shopping-cart"></i>
                                    <span t-attf-class="my_cart_quantity label label-primary" t-esc="product_id.product_cart_quantity or ''"/>
                                </span>
                            </t>
                            <!-- debug info Lang -->
                            <!-- <span t-att-data-lang="lang_id" > L: (<t t-esc="lang_name"/> , <t t-esc="lang_id" />) </span> -->
                        </li>
                        <t t-foreach="product_id.attribute_value_ids" t-as="value_id">
                            <t t-if="value_id.attribute_id.type == 'color'">
                                <li>
                                    <!-- debug info line number -->
                                    <!-- <span style="font-style: italic;" ><t t-esc="inc" /> : EAN <span t-field="product_id.ean13"/> - Reference ( <span t-field="product_id.default_code"/> ) </span> -->
                                    <span style="font-style: italic;" >EAN <span t-field="product_id.ean13"/> - Reference ( <span t-field="product_id.default_code"/> ) - <t t-esc="value_id.name"/> </span>
                                    <t t-set="inc" t-value="inc+1"/>
                                </li>

                                <li>
                                    <label class="yocolor" data-type="yocolormaker" t-att-data-params="value_id.jsdata" t-attf-style="background-color:#{value_id.color or value_id.name}">
                                        <input type="radio" class="js_variant_change"
                                            t-att-checked="'checked' if not inc else ''"
                                            t-att-name="'attribute-%s-%s' % (product_id.id, value_id.id)"
                                            t-att-value="value_id.id"
                                            t-att-title="value_id.name"/>
                                    </label>
                                </li>
                                <li>
                                    <form t-att-action="keep('/shop/cart/update')" class="js_add_cart_variants" method="POST">
                                      <div class="js_product">
                                        <t t-placeholder="select">
                                          <input name="product_id" t-att-value="product_id.id" type="hidden"/>
                                          <input name="lang_selected" t-att-value="lang_id" type="hidden"/>
                                          <input type="text" class="js_quantity input-product-detail-select-qty" data-min="1" name="add_qty" value="1"/>
                                        </t>
                                        <a id="add_to_cart" class="btn btn-primary btn-product-detail-add-to-cart btn-lg mt8 fa fa-shopping-cart js_check_product a-submit" href="#"></a>
                                      </div>
                                    </form>
                                </li>
                            </t>
                        </t>
                    </ul>
                </t>
            </ul>
        </template>

        <!-- Remove Block Policies -->
        <template id="yotech_tools_product_details" inherit_id='kingfisher_theme.product_details'>
            <xpath expr="//div[@class='col-xs-12 col-md-3 col-lg-3 col-sm-12 product-detail']" position="replace">
                <div></div>
            </xpath>
            <xpath expr="//div[@class='product-info']" position="replace">
                <div class="product-info">
                    <div class="col-xs-12 col-md-5 col-lg-8 col-sm-6 product-detail">
                        <h1 itemprop="name" t-field="product.name">Product Name</h1>
                        <span> Weight : <span t-field="product.weight"/></span><br/>
                        <span> Weight Net : <span t-field="product.weight_net"/></span><br/>
                        <span itemprop="url" style="display:none;" t-esc="'/shop/product/%s' % slug(product)"/>
                        <span t-if="product.description_sale and len(product.description_sale) &gt; 200">
                             <t t-set="description" t-value="product.description_sale[:200] and product.description_sale[:200].replace('+', '\n')+'...'"/>
                            <p class="text-muted "><t t-esc="description"/></p>
                        </span>
                        <span t-if="product.description_sale and len(product.description_sale) &lt; 200">
                            <p t-if="product.description_sale and len(product.description_sale)&gt; 0" t-field="product.description_sale" class="text-muted "/>
                        </span>
                        <br/>
                        <t t-call="yotech_tools.yotech_tools_products_variants"/>
                        <t t-if="len(product.attribute_line_ids) == 0" >
                            <span style="font-style: italic;" > EAN <span t-field="product.ean13"/> - Reference ( <span t-field="product.default_code"/> ) </span>
                            <br/><br/>
                            <form t-att-action="keep('/shop/cart/update')" style="display:block;" class="js_add_cart_variants" method="POST">
                              <div>
                                <input name="product_id" t-att-value="product.id" type="hidden"/>
                                <a id="add_to_cart" class="btn btn-primary btn-product-detail-add-to-cart btn-lg mt8 fa fa-shopping-cart js_check_product a-submit" href="#"> Add to Cart</a>
                              </div>
                            </form>
                        </t>
                    </div>
                </div>
            </xpath>
            <xpath expr="//div[@role='tabpanel']" position="replace">
                <div></div>
            </xpath>
        </template>

        <record id="view_yotech_tools_product_template_form" model="ir.ui.view">
            <field name="name">product.template.form.yotech.tools</field>
            <field name="model">product.template</field>
            <field name="priority">4</field>
            <field name="inherit_id" ref="product.product_template_form_view"/>
            <field name="arch" type="xml">
                <page string="Sales" position="inside">
                    <field name="message_type_ids">Messages List</field>
                </page>
            </field>
        </record>

<!-- not compliant with kingfisher-theme
<template id="custom_yotech_product" inherit_id="website_sale.product" name="Yotech-Product">
            <xpath expr="//hr[@t-if='product.description_sale']" position="replace">
                <hr t-if="product.description_sale"/>
                <div><p t-field="product.description_sale" class="text-muted"/></div>
                <hr/>
                <t t-if="product.message_type_ids">
                    <t t-foreach="product.message_type_ids" t-as="message_id">
                        <div><span name="info" t-raw="message_id.message"/></div>
                    </t>
                </t>
            </xpath>
        </template> -->

        <!-- Yotech Tools menu setting -->
        <menuitem name="Yotech Tools"
            id="root_menu_base_yotech_tools"
            groups="base.group_sale_salesman,base.group_sale_manager" parent="base.menu_config" sequence="10" />

        <menuitem id="menu_yotech_tools_settings" name="Yotech Tools" parent="root_menu_base_yotech_tools" sequence="9"/>

        <!-- Yotech Tools menu setting -->
        <record model="ir.actions.act_window" id="action_list_message_type_id">
            <field name="name">Message Type</field>
            <field name="res_model">message.type</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_yotech_tools_set_messages_type" action="action_list_message_type_id" name="Message Type" parent="menu_yotech_tools_settings" sequence = "1" />

        <record id="view_oms_cluster_tree" model="ir.ui.view">
            <field name="name">message.type.tree</field>
            <field name="model">message.type</field>
            <field name="priority">2</field>
            <field name="arch" type="xml">
                <tree string="Messages List">
                    <field name="name" string="Message name"/>
                </tree>
            </field>
        </record>

        <record id="view_yotech_tools_message_type_form" model="ir.ui.view">
            <field name="name">message.type.form.yotech.tools</field>
            <field name="model">message.type</field>
            <field name="priority">4</field>
            <field name="arch" type="xml">
                <form string="Sales Order">
                    <field name="name">Name</field>
                    <seperator/>
                    <field name="message">Message</field>
                </form>
            </field>
        </record>

        <record id="view_yotech_tools_product_product_form" model="ir.ui.view">
            <field name="name">product.product.yotech.from</field>
            <field name="model">product.product</field>
            <field name="priority">4</field>
            <field name="inherit_id" ref="product.product_normal_form_view"/>
            <field name="arch" type="xml">
                <field name="lst_price" position="after">
                    <group string="Yotech tools">
                        <field name="product_new_tmpl_id"/>
                        <button colspan="2" name="button_switch_template" string="Switch Product Template" type="object" icon="gtk-execute" class="oe_inline"/>
                        <field name="attribute_line_ids" widget="one2many_list" readonly="True">
                            <tree string="Variants" editable="bottom">
                                <field name="product_tmpl_id" readonly="True"/>
                                <field name="attribute_id"/>
                                <field name="value_ids" widget="many2many_tags" domain="[('attribute_id', '=', attribute_id)]" />
                            </tree>
                        </field>
                    </group>
                </field>
            </field>
        </record>
        <!-- variants -->

        <record id="variants_template_tree_view" model="ir.ui.view">
            <field name="name">variants.template.tree</field>
            <field name="model">product.attribute.value</field>
            <field name="arch" type="xml">
                <tree string="Variant Values" editable="top">
                    <field name="sequence" widget="handle"/>
                    <field name="attribute_id"/>
                    <field name="name"/>
                </tree>
            </field>
        </record>
    </data>
</openerp>
