<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <template id="add_css_js" name="yotech_tools_yocolormaker" inherit_id="website.layout">
            <xpath expr="//html/head" position="inside">
                <link href="/yotech_tools/static/src/css/yocolormaker.css" rel="stylesheet"/>
                <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
                <script type="text/javascript" src="/yotech_tools/static/src/js/yocolormaker.js"></script>
            </xpath>
            <xpath expr="//html/body" position="inside">
                <!-- -->
            </xpath>
        </template>

        <!-- Product attribute -->

        <record id="yotech_tools_variants_template_tree_view" model="ir.ui.view">
            <field name="name">yotech_tools.variants.template.tree</field>
            <field name="model">product.attribute.value</field>
            <field name="inherit_id" ref="product.variants_tree_view"/>
            <field name="arch" type="xml">
                <field name="name" position="after">
                    <field name="jsdata"/>
                </field>
            </field>
        </record>

        <!-- Add Btn Add to Cart On each variant line -->
        <template id="yotech_tools_products_variants" inherit_id="website_sale.variants">
            <xpath expr="//ul[@t-att-data-attribute_value_ids='attribute_value_ids']" position="replace">
                <ul t-attf-class="list-unstyled js_add_cart_variants #{ul_class}" t-att-data-attribute_value_ids="attribute_value_ids">
                    <t t-foreach="product.attribute_line_ids" t-as="variant_id">
                        <li t-if="len(variant_id.value_ids) > 1">
                          <strong t-field="variant_id.attribute_id.name"/>
                          <br/>
                          <t t-if="variant_id.attribute_id.type in ['select', 'hidden']">
                            <select class="form-control js_variant_change" t-att-name="'attribute-%s-%s' % (product.id, variant_id.attribute_id.id)">
                              <t t-foreach="variant_id.value_ids" t-as="value_id">
                                <option t-att-value="value_id.id">
                                    <span t-field="value_id.name"/>
                                    <span t-if="value_id.price_extra">
                                        <t t-esc="value_id.price_extra > 0 and '+' or ''"/><span t-field="value_id.price_extra" style="white-space: nowrap;" t-field-options='{
                                                 "widget": "monetary",
                                                  "from_currency": "product.company_id.currency_id",
                                                 "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                                             }'/>
                                    </span>
                                </option>
                              </t>
                            </select>
                          </t>
                          <t t-if="variant_id.attribute_id.type == 'radio'">
                            <ul class="list-unstyled">
                                <t t-set="inc" t-value="0"/>
                                <t t-foreach="variant_id.value_ids" t-as="value_id">
                                    <li class="form-group js_attribute_value" style="margin: 0;">
                                        <label class="control-label" style="margin: 0 20px;">
                                            <input type="radio" class="js_variant_change" t-att-checked="'checked' if not inc else ''" t-att-name="'attribute-%s-%s' % (product.id, variant_id.attribute_id.id)" t-att-value="value_id.id" style="vertical-align: top; margin-right: 10px;"/>
                                            <span t-field="value_id.name"/>
                                            <span class="badge" t-if="value_id.price_extra">
                                                <t t-esc="value_id.price_extra > 0 and '+' or ''"/><span t-field="value_id.price_extra" style="white-space: nowrap;" t-field-options='{
                                                        "widget": "monetary",
                                                        "from_currency": "product.company_id.currency_id",
                                                        "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                                                     }'/>
                                            </span>
                                        </label>
                                    </li>
                                    <t t-set="inc" t-value="inc+1"/>
                                </t>
                            </ul>
                          </t>
                          <t t-if="variant_id.attribute_id.type == 'color'">
                            <t t-set="inc" t-value="0"/>
                            <ul class="ul-product-detail-add-to-cart" t-foreach="variant_id.value_ids" t-as="value_id">
                                <li>
                                    <t t-call="website_sale.product_price"/>
                                </li>
                                <li>
                                    <span style="font-style: italic;" >EAN13 <span t-field="value_id.product_ids[0].ean13"/> - Reference (<span t-field="value_id.product_ids[0].default_code"/> )</span>
                                </li>
                                <li>
                                    <label t-attf-style="background-color:#{value_id.color or value_id.name}"
                                           t-attf-class="css_attribute_color #{'active' if not inc else ''}">
                                        <canvas style="margin-bottom: -5px;" data-type="yocolormaker"  t-att-data-params="value_id.jsdata" width="28px"  height="28px">
                                            <input type="radio" class="js_variant_change"
                                                t-att-checked="'checked' if not inc else ''"
                                                t-att-name="'attribute-%s-%s' % (product.id, variant_id.attribute_id.id)"
                                                t-att-value="value_id.id"
                                                t-att-title="value_id.name"/>
                                        </canvas>
                                    </label>
                                    <t t-set="inc" t-value="inc+1"/>
                                </li>
                                <li>
                                    <form t-att-action="keep('/shop/cart/update')" class="js_add_cart_variants" method="POST">
                                      <div class="js_product">
                                        <t t-placeholder="select">
                                          <input name="product_id" t-att-value="product.product_variant_ids[0].id" type="hidden"/>
                                          <input type="text" class="js_quantity input-product-detail-select-qty" data-min="1" name="add_qty" value="1"/>
                                        </t>
                                        <p t-if="len(product.product_variant_ids) &gt; 1" class="css_not_available_msg bg-danger" style="padding: 15px;">Product not available</p>
                                        <a id="add_to_cart" class="btn btn-primary btn-product-detail-add-to-cart btn-lg mt8 fa fa-shopping-cart js_check_product a-submit" href="#"></a>
                                      </div>
                                    </form>
                                </li>
                            </ul>
                          </t>
                        </li>
                    </t>
                </ul>
            </xpath>
        </template>

        <record id="view_yotech_tools_product_template_form" model="ir.ui.view">
            <field name="name">product.template.form.yotech.tools</field>
            <field name="model">product.template</field>
            <field name="priority">4</field>
            <field name="inherit_id" ref="product.product_template_form_view"/>
            <field name="arch" type="xml">
                <page string="Sales" position="inside">
                    <field name="message_type_ids">Messages List</field>
                </page>
            </field>
        </record>

<!-- not compliant with kingfisher-theme
<template id="custom_yotech_product" inherit_id="website_sale.product" name="Yotech-Product">
            <xpath expr="//hr[@t-if='product.description_sale']" position="replace">
                <hr t-if="product.description_sale"/>
                <div><p t-field="product.description_sale" class="text-muted"/></div>
                <hr/>
                <t t-if="product.message_type_ids">
                    <t t-foreach="product.message_type_ids" t-as="message_id">
                        <div><span name="info" t-raw="message_id.message"/></div>
                    </t>
                </t>
            </xpath>
        </template> -->

        <!-- Yotech Tools menu setting -->
        <menuitem name="Yotech Tools"
            id="root_menu_base_yotech_tools"
            groups="base.group_sale_salesman,base.group_sale_manager" parent="base.menu_config" sequence="10" />

        <menuitem id="menu_yotech_tools_settings" name="Yotech Tools" parent="root_menu_base_yotech_tools" sequence="9"/>

        <!-- Yotech Tools menu setting -->
        <record model="ir.actions.act_window" id="action_list_message_type_id">
            <field name="name">Message Type</field>
            <field name="res_model">message.type</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_yotech_tools_set_messages_type" action="action_list_message_type_id" name="Message Type" parent="menu_yotech_tools_settings" sequence = "1" />

        <record id="view_oms_cluster_tree" model="ir.ui.view">
            <field name="name">message.type.tree</field>
            <field name="model">message.type</field>
            <field name="priority">2</field>
            <field name="arch" type="xml">
                <tree string="Messages List">
                    <field name="name" string="Message name"/>
                </tree>
            </field>
        </record>

        <record id="view_yotech_tools_message_type_form" model="ir.ui.view">
            <field name="name">message.type.form.yotech.tools</field>
            <field name="model">message.type</field>
            <field name="priority">4</field>
            <field name="arch" type="xml">
                <form string="Sales Order">
                    <field name="name">Name</field>
                    <seperator/>
                    <field name="message">Message</field>
                </form>
            </field>
        </record>

        <record id="view_yotech_tools_product_product_form" model="ir.ui.view">
            <field name="name">product.product.yotech.from</field>
            <field name="model">product.product</field>
            <field name="priority">4</field>
            <field name="inherit_id" ref="product.product_normal_form_view"/>
            <field name="arch" type="xml">
                <field name="lst_price" position="after">
                    <group string="Yotech tools">
                        <field name="product_new_tmpl_id"/>
                        <button colspan="2" name="button_switch_template" string="Switch Product Template" type="object" icon="gtk-execute" class="oe_inline"/>
                        <field name="attribute_line_ids" widget="one2many_list" readonly="True">
                            <tree string="Variants" editable="bottom">
                                <field name="product_tmpl_id" readonly="True"/>
                                <field name="attribute_id"/>
                                <field name="value_ids" widget="many2many_tags" domain="[('attribute_id', '=', attribute_id)]" />
                            </tree>
                        </field>
                    </group>
                </field>
            </field>
        </record>
        <!-- variants -->

        <record id="variants_template_tree_view" model="ir.ui.view">
            <field name="name">variants.template.tree</field>
            <field name="model">product.attribute.value</field>
            <field name="arch" type="xml">
                <tree string="Variant Values" editable="top">
                    <field name="sequence" widget="handle"/>
                    <field name="attribute_id"/>
                    <field name="name"/>
                </tree>
            </field>
        </record>
    </data>
</openerp>
